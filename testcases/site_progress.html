



<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Construction site progress &mdash; Geomapi 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Validation Tools" href="validationtools.html" />
    <link rel="prev" title="Combination Tools" href="combinationtools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/geomapi_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../information/getting%20started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../information/nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../information/ontology.html">Ontology</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_nodes.html">Node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_meshnodes.html">MeshNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_pointcloudnodes.html">PointCloudNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_bimnodes.html">BIMNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_linesetnodes.html">LineSetNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_imagenodes.html">ImageNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_orthonodes.html">OrthoNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_panonodes.html">PanoNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_setnodes.html">SetNode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_node_selection.html">Node selection</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Test Cases:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="alignmenttools.html">Alignment Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="combinationtools.html">Combination Tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Construction site progress</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bim-model">BIM Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#measurement-epoch-week-22">Measurement Epoch week 22</a></li>
<li class="toctree-l2"><a class="reference internal" href="#measurement-epoch-week-34">Measurement Epoch week 34</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preprocessing-the-bim-model">Preprocessing the BIM Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reloading-from-graph">Reloading from graph</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-week-22">Analysis week 22</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preprocess-measurements-week-22">Preprocess measurements week 22</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sessionnode">SessionNode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">Reloading from graph</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#theoretical-visibility-week-22">Theoretical visibility week 22</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#compute-theoretical-visibility-v-i-of-bimnodes">Compute theoretical visibility <span class="math notranslate nohighlight">\(v_i\)</span> of BIMNodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#discard-irrelevant-or-unobserved-resourcenodes-and-bimnodes">Discard irrelevant or unobserved resourceNodes and bimNodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#discard-bimnodes-with-a-low-theoretical-visibility">(1) Discard BIMNodes with a low theoretical visibility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#check-which-bim-geometries-fall-within-the-session-node">(2) Check which BIM geometries fall within the session node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#check-which-resources-actually-see-the-target-bim-objects">(3) Check which resources actually see the target BIM objects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#import-geometries-week-22">Import geometries week 22</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-percentage-of-completion-week-22">Compute Percentage-of-Completion week 22</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialize-results-week-22">Serialize results week 22</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analysis-week-34">Analysis week 34</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preprocess-measurements-week-34">Preprocess measurements week 34</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">SessionNode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Reloading from graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#theoretical-visibility-week-34">Theoretical visibility week 34</a></li>
<li class="toctree-l3"><a class="reference internal" href="#import-geometries-week-34">Import geometries week 34</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-percentage-of-completion-week-34">Compute Percentage-of-Completion week 34</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialize-results-week-34">Serialize results week 34</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compare-changes-between-week-22-and-week-34">Compare changes between week 22 and week 34</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#future-work">Future work</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="validationtools.html">Validation Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="volume_calculation.html">Volume calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../geomapi/geomapi.nodes.html">geomapi.nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geomapi/geomapi.utils.html">geomapi.utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geomapi/geomapi.tools.html">geomapi.tools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/environment%20creation.html">User environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/environment%20creation.html#developer-environment">Developer environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/packaging.html">Packaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/ontology%20creation.html">Ontology Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testcase%20creation.html">Testcase Creation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../team/team.html">Team</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Geomapi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Construction site progress</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/testcases/site_progress.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="construction-site-progress">
<h1>Construction site progress<a class="headerlink" href="#construction-site-progress" title="Link to this heading"></a></h1>
<p>Progress monitoring of construction sites is becoming increasingly popular in the construction industry. Especially with the integration of 4D BIM, the progression and quality of the construction process can be better quantified. A key aspect is the detection of the changes between consecutive epochs of measurements on the site. However, the development of automated procedures is challenging due to noise, occlusions and the associativity between different objects. Additionally, objects are built in stages and thus varying states have to be detected according to the Percentage of Completion.</p>
<p><strong>Progress on site</strong>: This task can be formulated as a query to determine the ratio of the observed boundary surface area of each object compared to the surface area that can theoretically be observed (Eq.1).</p>
<div class="math notranslate nohighlight">
\[PoC=\frac{\text{observed surface Area}}{\text{theoretical visibility}}\]</div>
<p>Where a threshold can be used to state which objects are built or not (Eq.2).</p>
<div class="math notranslate nohighlight">
\[\begin{split} \text{built state}= 1 \text{  if  } PoC \geq t_v \\ 
0 \text{  else  } \end{split}\]</div>
<p>In this testcase, we will discuss how to use GEOMAPI to assess progress on a typical BIM-driven construction site. Concretely, we will demonstrate the API’s functionality to:</p>
<ol class="arabic simple">
<li><p>Preprocess the BIM data from multiple IFC files</p></li>
<li><p>Preprocess the various remote sensing data (images, meshes, point clouds) of two measurement epochs</p></li>
<li><p>Make a subselection of observable objects</p></li>
<li><p>Determine the PoC of the observable objects</p></li>
<li><p>Serialize the analysis results</p></li>
<li><p>Use the resulting RDF Graph of epoch 1 to support the analysis of epoch 2.</p></li>
</ol>
<p>First the geomapi and external packages are imported</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<section id="bim-model">
<h2>BIM Model<a class="headerlink" href="#bim-model" title="Link to this heading"></a></h2>
<p>The dataset that will be used for this analysis is a residential complex that includes 3 seperate buildings and a common underground parking, each of which consists of a seperate IFC file. Fig. 1 shows Building 1 (1192 elements) and the parking dataset (2705 elements). Both datasets depict the construction site structural phase, so the main classes include:</p>
<ol class="arabic simple">
<li><p>IfcWallStandardCase:     309 +   340     =   649</p></li>
<li><p>ifcSlab:                 237 +   1150    =   1387</p></li>
<li><p>ifcBeam:                 200 +   225     =   425</p></li>
<li><p>IfcColumn:               95  +   125     =   220</p></li>
<li><p>IfcStair:                11  +   10      =   22</p></li>
</ol>
<p><strong>Fig.1</strong>: Construction site: (red) building 1 and (white) underground parking in seperate IFC files.
<img alt="rendering" src="../_images/testcase_progress1.PNG" /></p>
</section>
<section id="measurement-epoch-week-22">
<h2>Measurement Epoch week 22<a class="headerlink" href="#measurement-epoch-week-22" title="Link to this heading"></a></h2>
<p>During week 22, a portion of the site was captured with terrestrial laser scanners and hand held imagery. During that period, the ground floor of the parking and structural columns were built, and the farmwork of level 1 was being erected. The following measurements were recorded:</p>
<ol class="arabic simple">
<li><p>45 10M point scans with a Leica BLK (Fig.2 top left)</p></li>
<li><p>715 20MPix Images with a Canon EOS 5D Mark II (Fig.2 top right), resulting in a 240k Mesh (Fig.2 bottom left) and 11M point cloud (Fig.2 bottom right).</p></li>
</ol>
<p><strong>Fig.2</strong>: (top left) 45 BLK point clouds, (top right) 715 geolocated images, (bottom left) 240k photogrammetric mesh and (bottom right) 11M photogrammetric point cloud.</p>
<a class="reference internal image-reference" href="../pics/week22_pcd.PNG"><img alt="../pics/week22_pcd.PNG" src="../pics/week22_pcd.PNG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week22_img.PNG"><img alt="../_images/week22_img.PNG" src="../_images/week22_img.PNG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week22_mesh1.PNG"><img alt="../_images/week22_mesh1.PNG" src="../_images/week22_mesh1.PNG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week22_pcd1.PNG"><img alt="../_images/week22_pcd1.PNG" src="../_images/week22_pcd1.PNG" style="width: 49%;" />
</a>
</section>
<section id="measurement-epoch-week-34">
<h2>Measurement Epoch week 34<a class="headerlink" href="#measurement-epoch-week-34" title="Link to this heading"></a></h2>
<p>Week 34 is very similar. Ofcourse, some complexities are inherently present such as precipitation, occlusions, rebar, etc. (Fig.3). These objects cause significant amounts of noise, clutter and confusion in any geomatics analysis.</p>
<p><strong>Fig.3</strong>: Images of week 34 showing some documentation obstacles on the site including formwork, precipitation, etc.</p>
<a class="reference internal image-reference" href="../_images/week22_img2.JPG"><img alt="../_images/week22_img2.JPG" src="../_images/week22_img2.JPG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week22_img3.JPG"><img alt="../_images/week22_img3.JPG" src="../_images/week22_img3.JPG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week22_img4.JPG"><img alt="../_images/week22_img4.JPG" src="../_images/week22_img4.JPG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week22_img5.JPG"><img alt="../_images/week22_img5.JPG" src="../_images/week22_img5.JPG" style="width: 49%;" />
</a>
</section>
<section id="preprocessing-the-bim-model">
<h2>Preprocessing the BIM Model<a class="headerlink" href="#preprocessing-the-bim-model" title="Link to this heading"></a></h2>
<p>Following the GEOMAPI principles, we serialize all relevent objects in the BIM model to an RDF Graph. This includes the structural elements of the classes listed at the top of this document. We could ofcourse list every single object in the IFC but that would unnecessirely complicate the calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ifcPath1</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;IFC&#39;</span><span class="p">,</span><span class="s1">&#39;Academiestraat_parking.ifc&#39;</span><span class="p">)</span>
<span class="n">ifcPath2</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;IFC&#39;</span><span class="p">,</span><span class="s1">&#39;Academiestraat_building_1.ifc&#39;</span><span class="p">)</span>
<span class="n">BIMNodes</span><span class="o">=</span><span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<p>For this analysis, we parse the ifc files using all CPU’s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BIMNodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tl</span><span class="o">.</span><span class="n">ifc_to_nodes_multiprocessing</span><span class="p">(</span><span class="n">ifcPath</span><span class="o">=</span><span class="n">ifcPath1</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">BIMNodes</span><span class="p">))</span>
<span class="n">BIMNodes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tl</span><span class="o">.</span><span class="n">ifc_to_nodes_multiprocessing</span><span class="p">(</span><span class="n">ifcPath</span><span class="o">=</span><span class="n">ifcPath2</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> 
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">BIMNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2368
3528
</pre></div>
</div>
</div>
</div>
<p>It is not uncommon for certain elements to not have geometry or have some invalid meshes. These will yield <strong>Geometry Production Errors</strong>.</p>
<p>Next, we filter out the types=[‘IfcBeam’,’IfcColumn’] that we wish to evaluate in this testcase.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ifcBeamNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span> <span class="k">if</span> <span class="s1">&#39;IfcBeam&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">className</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ifcBeamNodes</span><span class="p">))</span>
<span class="n">ifcColumnNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span> <span class="k">if</span> <span class="s1">&#39;IfcColumn&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">className</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ifcColumnNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>417
220
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bimGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">(</span><span class="n">bimGeometries</span> <span class="o">+</span> <span class="p">[</span><span class="n">meshNode</span><span class="o">.</span><span class="n">resource</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.4</strong>: Images of the IfcBeams and IfcColumn that will be evaluated.
<img alt="rendering" src="../_images/week22_columns_beams1.PNG" /></p>
<p>When looking at the instance variables of one of the BIMNodes, it is revealed that GEOMAPI has indeed gathered all the relevant metadata for geomatic analysis of the objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">BIMNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>              
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_ifcPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\IFC\\Academiestraat_parking.ifc&#39;,
 &#39;_globalId&#39;: &#39;31ITCLLef6cxVKsJ1O6alJ&#39;,
 &#39;_cartesianBounds&#39;: array([-7.06959166, -6.29710762, 82.65923323, 94.05945977,  6.3       ,
         7.49      ]),
 &#39;_orientedBounds&#39;: array([[-6.56972877, 82.65931266,  7.52010319],
        [-6.29703229, 94.0506375 ,  7.48999176],
        [-6.56980573, 82.65609109,  6.30066736],
        [-7.06958983, 82.67127881,  7.52010312],
        [-6.79697031, 94.05938208,  6.27055586],
        [-7.06966679, 82.66805724,  6.30066729],
        [-6.79689335, 94.06260366,  7.48999169],
        [-6.29710925, 94.04741593,  6.27055593]]),
 &#39;_orientedBoundingBox&#39;: OrientedBoundingBox: center: (-6.68335, 88.3593, 6.89533), extent: 11.3946, 1.21944, 0.500004),
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///282_SF_f2_Rectangular_50_119_966607_31ITCLLef6cxVKsJ1O6alJ&#39;),
 &#39;_graph&#39;: None,
 &#39;_graphPath&#39;: None,
 &#39;_path&#39;: None,
 &#39;_name&#39;: &#39;282_SF_f2_Rectangular:50/119:966607&#39;,
 &#39;_timestamp&#39;: None,
 &#39;_resource&#39;: TriangleMesh with 45 points and 78 triangles.,
 &#39;_cartesianTransform&#39;: array([[ 1.        ,  0.        ,  0.        , -6.69666565],
        [ 0.        ,  1.        ,  0.        , 88.96377834],
        [ 0.        ,  0.        ,  1.        ,  7.01177778],
        [ 0.        ,  0.        ,  0.        ,  1.        ]]),
 &#39;className&#39;: &#39;IfcBeam&#39;,
 &#39;pointCount&#39;: 45,
 &#39;faceCount&#39;: 78}
</pre></div>
</div>
</div>
</div>
<p>We can buffer these geometries on drive so we only have to parse the ifc file once. We can then reload these geometries to assess week 26.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">BIMNodes</span><span class="p">:</span>
    <span class="n">node</span><span class="o">.</span><span class="n">save_resource</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="s1">&#39;BIM&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This also sets the path of each node</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">BIMNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Scan-to-BIM repository\geomapi\test\testfiles\myAnalysisFolder\BIM\Basic_Wall_162_WA_f2_Retaining_concrete_300mm_-_tegen_beschoeiing_903129_0_Z_Q8COz94wZzVDqlx5Ny.ply
</pre></div>
</div>
</div>
</div>
<p>Now it is good practice to already serialize these nodes in a RDF graph so we can rapidly load the nodes from the graphs in a next code run. In this testcase, we will store the generated graph in the same location as the buffered mesh geometries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;BIM&#39;</span><span class="p">,</span><span class="s1">&#39;bimGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">tl</span><span class="o">.</span><span class="n">nodes_to_graph</span><span class="p">(</span><span class="n">nodelist</span><span class="o">=</span><span class="n">BIMNodes</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Graph identifier=Nd78fbef4e17942d9a0598eb808e0ce3c (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;
</pre></div>
</div>
</div>
</div>
<p>This sets each BIMNodes’ graphpath and graph. The graph of BIMNodes[0] then looks as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">BIMNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graphPath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">BIMNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Scan-to-BIM repository\geomapi\test\testfiles\myAnalysisFolder\BIM\bimGraph.ttl
@prefix e57: &lt;http://libe57.org#&gt; .
@prefix ifc: &lt;http://ifcowl.openbimstandards.org/IFC2X3_Final#&gt; .
@prefix openlabel: &lt;https://www.asam.net/index.php?eID=dumpFile&amp;t=f&amp;f=3876&amp;token=413e8c85031ae64cc35cf42d0768627514868b2f#&gt; .
@prefix v4d: &lt;https://w3id.org/v4d/core#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

&lt;file:///Basic_Wall_162_WA_f2_Retaining_concrete_300mm_-_tegen_beschoeiing_903129_0_Z_Q8COz94wZzVDqlx5Ny&gt; a v4d:BIMNode ;
    ifc:className &quot;IfcWall&quot; ;
    ifc:globalId &quot;0$Z_Q8COz94wZzVDqlx5Ny&quot; ;
    ifc:ifcPath &quot;..\\..\\IFC\\Academiestraat_parking.ifc&quot; ;
    e57:cartesianBounds &quot;&quot;&quot;[-19.23472973 -12.25564312  65.15487321  90.43620808   3.75
   6.45      ]&quot;&quot;&quot; ;
    e57:cartesianTransform &quot;&quot;&quot;[[  1.           0.           0.         -15.01948444]
 [  0.           1.           0.          75.43717007]
 [  0.           0.           1.           5.1       ]
 [  0.           0.           0.           1.        ]]&quot;&quot;&quot; ;
    e57:pointCount 26 ;
    v4d:faceCount 48 ;
    v4d:name &quot;Basic Wall:162_WA_f2_Retaining concrete 300mm - tegen beschoeiing:903129&quot; ;
    v4d:orientedBounds &quot;&quot;&quot;[[-18.94468192  90.47741615   3.75      ]
 [-12.25492307  65.15506344   3.75      ]
 [-18.94468192  90.47741615   6.45      ]
 [-19.23544856  90.40060027   3.75      ]
 [-12.54568971  65.07824756   6.45      ]
 [-19.23544856  90.40060027   6.45      ]
 [-12.54568971  65.07824756   3.75      ]
 [-12.25492307  65.15506344   6.45      ]]&quot;&quot;&quot; ;
    v4d:path &quot;Basic_Wall_162_WA_f2_Retaining_concrete_300mm_-_tegen_beschoeiing_903129_0_Z_Q8COz94wZzVDqlx5Ny.ply&quot; ;
    openlabel:timestamp &quot;2022-08-24T09:33:45&quot; .
</pre></div>
</div>
</div>
</div>
<p><strong>Note</strong> that all path triples in graph are serialized relative to the graphPath so to make it easier to move the entire folderstructure.</p>
<section id="reloading-from-graph">
<h3>Reloading from graph<a class="headerlink" href="#reloading-from-graph" title="Link to this heading"></a></h3>
<p>The above steps only have to be performed once. On reruns of the code or future analysis, we can initialize the same nodes from their serialized triples in the bimGraph. This is significantly faster for smaller graphs for we are serializing over 3500 objects which result in over 40k triples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;BIM&#39;</span><span class="p">,</span><span class="s1">&#39;bimGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">BIMNodes</span><span class="o">=</span><span class="n">tl</span><span class="o">.</span><span class="n">graph_path_to_nodes</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">BIMNodes</span><span class="p">))</span>
<span class="n">ifcBeamNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span> <span class="k">if</span> <span class="s1">&#39;IfcBeam&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">className</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ifcBeamNodes</span><span class="p">))</span>
<span class="n">ifcColumnNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span> <span class="k">if</span> <span class="s1">&#39;IfcColumn&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">className</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ifcColumnNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Open3D WARNING] Unable to load file d:\Scan-to-BIM repository\geomapi\test\testfiles\myAnalysisFolder\BIM\282_SC_f2_Round:Ø30:882687.obj with ASSIMP
[Open3D WARNING] Unable to load file d:\Scan-to-BIM repository\geomapi\test\testfiles\myAnalysisFolder\BIM\282_SC_f2_Round:Ø30:883780.obj with ASSIMP
[Open3D WARNING] Unable to load file d:\Scan-to-BIM repository\geomapi\test\testfiles\myAnalysisFolder\BIM\282_SC_f2_Round:Ø30:883870.obj with ASSIMP
3528
417
220
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-week-22">
<h2>Analysis week 22<a class="headerlink" href="#analysis-week-22" title="Link to this heading"></a></h2>
<section id="preprocess-measurements-week-22">
<h3>Preprocess measurements week 22<a class="headerlink" href="#preprocess-measurements-week-22" title="Link to this heading"></a></h3>
<p>Data data of week 22 (see above) will be imported as part of a SessionNode. This sessionNode contains the individual Nodes of each of the resources and also some general metadata.</p>
<p>First, we parse each set of resources (46 point clouds, 693+ Images and the photogrammetric mesh).</p>
<p><strong>NOTE</strong>: This is alot of data, some of which we potentially don’t need as observable objects might not be located within the sensors Field-of-View. GEOMAPI plans for this, and allows Node metadata initialisation from other sources but the actual data such as image metadata files, e57 headers, etc. The actual resources that are needed can be imported at a later stage through get_resource() methods.</p>
<ol class="arabic simple">
<li><p><strong>E57 POINT CLOUDS</strong>: These nodes from the e57 header instead of actually importing the data so a first spatial analysis can be conducted effeciently</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e57Path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="s1">&#39;2018-06 Werfopvolging Academiestraat Gent&#39;</span><span class="p">,</span><span class="s1">&#39;week 22&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">,</span><span class="s1">&#39;week 22 lidar_CC.e57&#39;</span><span class="p">)</span>
<span class="n">e57Path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">u0094523</span><span class="se">\\</span><span class="s2">Documents</span><span class="se">\\</span><span class="s2">week 22 lidar_CC.e57&quot;</span><span class="p">)</span>

<span class="n">pcdNodes</span><span class="o">=</span><span class="n">tl</span><span class="o">.</span><span class="n">e57header_to_nodes</span><span class="p">(</span><span class="n">e57Path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pcdNodes</span><span class="p">))</span>

<span class="c1">#serialize nodes</span>
<span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">,</span><span class="s1">&#39;pcdGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">tl</span><span class="o">.</span><span class="n">nodes_to_graph</span><span class="p">(</span><span class="n">nodelist</span><span class="o">=</span><span class="n">pcdNodes</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pcdNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>              
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_e57Index&#39;: 0,
 &#39;pointCount&#39;: 12044232,
 &#39;e57XmlPath&#39;: None,
 &#39;_cartesianBounds&#39;: array([ -4.835392  ,  63.61618042,  15.48379898, 110.15341187,
          1.53644395,  52.72476959]),
 &#39;_orientedBounds&#39;: None,
 &#39;_orientedBoundingBox&#39;: None,
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///academiestraat_week_22_39&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=N8e9662fa0b65459baab80065d781079c (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder\\PCD\\pcdGraph.ttl&#39;,
 &#39;_path&#39;: &#39;C:\\Users\\u0094523\\Documents\\week 22 lidar_CC.e57&#39;,
 &#39;_name&#39;: &#39;academiestraat week 22 39&#39;,
 &#39;_timestamp&#39;: &#39;2022-08-31T14:07:41&#39;,
 &#39;_resource&#39;: None,
 &#39;_cartesianTransform&#39;: array([[ 5.14918372e-01,  8.56862431e-01,  2.54134841e-02,
          2.27048357e+01],
        [-8.56208319e-01,  5.15526552e-01, -3.37592856e-02,
          5.93459397e+01],
        [-4.20283893e-02, -4.37596012e-03,  9.99106834e-01,
          4.85647109e+00],
        [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
          1.00000000e+00]])}
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Geolocated Images</strong>: Analogue to the point cloud data, the ImageNodes are initialised from a set of Reality Capture .xmp files, one for each image.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="s1">&#39;2018-06 Werfopvolging Academiestraat Gent&#39;</span><span class="p">,</span><span class="s1">&#39;week 22&#39;</span><span class="p">,</span><span class="s1">&#39;IMG_RGB&#39;</span><span class="p">)</span>
<span class="n">files</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">get_list_of_files</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">xmpFiles</span><span class="o">=</span><span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xmp&#39;</span><span class="p">)]</span>
<span class="n">imgNodes</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">xmpFiles</span><span class="p">:</span>
    <span class="n">imgNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ImageNode</span><span class="p">(</span><span class="n">xmpPath</span><span class="o">=</span><span class="n">file</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imgNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>693
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#serialize nodes</span>
<span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;IMG&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;IMG&#39;</span><span class="p">,</span><span class="s1">&#39;imgGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">tl</span><span class="o">.</span><span class="n">nodes_to_graph</span><span class="p">(</span><span class="n">nodelist</span><span class="o">=</span><span class="n">imgNodes</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">imgNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>              
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_xmlPath&#39;: None,
 &#39;_xmpPath&#39;: &#39;d:\\Data\\2018-06 Werfopvolging Academiestraat Gent\\week 22\\IMG_RGB\\IMG_8117.xmp&#39;,
 &#39;_orientedBoundingBox&#39;: None,
 &#39;imageWidth&#39;: 5616,
 &#39;imageHeight&#39;: 3744,
 &#39;focalLength35mm&#39;: 24.2478838617657,
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///IMG_8117&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=N9b4969503d004cd89418e82889dc7013 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder\\IMG\\imgGraph.ttl&#39;,
 &#39;_path&#39;: &#39;d:\\Data\\2018-06 Werfopvolging Academiestraat Gent\\week 22\\IMG_RGB\\IMG_8117.JPG&#39;,
 &#39;_name&#39;: &#39;IMG_8117&#39;,
 &#39;_timestamp&#39;: &#39;2018-05-31T12:51:10&#39;,
 &#39;_resource&#39;: None,
 &#39;_cartesianTransform&#39;: array([[ 9.99663047e-01, -2.39186423e-02, -1.00841979e-02,
          2.65242540e+01],
        [-1.59884398e-02, -2.61328203e-01, -9.65117578e-01,
          4.63456265e+01],
        [ 2.04490168e-02,  9.64953610e-01, -2.61622569e-01,
          5.41631927e+00],
        [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
          1.00000000e+00]]),
 &#39;coordinateSystem&#39;: &#39;geospatial-wgs84&#39;,
 &#39;principalPointU&#39;: 0.00121787058752799,
 &#39;principalPointV&#39;: -0.00280510072900163,
 &#39;distortionCoeficients&#39;: [-0.124808145909033,
  0.103745993250385,
  -0.00726952029128824,
  0.0,
  0.0,
  0.0],
 &#39;resolutionUnit&#39;: 2,
 &#39;geospatialTransform&#39;: [None, None, None]}
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p><strong>Photogrammetric mesh</strong>: Mesh files have no metadata headers so the data has to be loaded by GEOMAPI. However, to save memory (and to illustrate the non-data functionality), we will discard the data as soon as the relevant metadata is extracted.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meshPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">,</span><span class="s1">&#39;week22.obj&#39;</span><span class="p">)</span>
<span class="n">meshNode</span><span class="o">=</span><span class="n">MeshNode</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">meshPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#serialize nodes</span>
<span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">,</span><span class="s1">&#39;meshGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">meshNode</span><span class="o">.</span><span class="n">to_graph</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">meshNode</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>     
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;pointCount&#39;: 330263,
 &#39;faceCount&#39;: 485077,
 &#39;_cartesianBounds&#39;: array([-37.36532974, 106.94235229,  16.87863541, 130.69406128,
          0.71651864,  23.73304558]),
 &#39;_orientedBounds&#39;: array([[-1.96025705e+01,  1.65884170e+02,  2.22874728e+01],
        [ 1.22465481e+02,  1.23859452e+02,  2.29468259e+01],
        [-5.26111776e+01,  5.43129171e+01,  2.33762909e+01],
        [-1.95654721e+01,  1.65648765e+02, -7.09825518e-01],
        [ 8.94939722e+01,  1.20527931e+01,  1.03834556e+00],
        [-5.25740791e+01,  5.40775120e+01,  3.78992525e-01],
        [ 1.22502579e+02,  1.23624046e+02, -5.04724793e-02],
        [ 8.94568738e+01,  1.22881982e+01,  2.40356439e+01]]),
 &#39;_orientedBoundingBox&#39;: OrientedBoundingBox: center: (34.9457, 88.9685, 11.6629), extent: 148.155, 116.357, 22.9985),
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///week22&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=N4472d046688d40a486d6000dbde7fe54 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder\\MESH\\meshGraph.ttl&#39;,
 &#39;_path&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\MESH\\week22.obj&#39;,
 &#39;_name&#39;: &#39;week22&#39;,
 &#39;_timestamp&#39;: &#39;2022-08-02T08:25:01&#39;,
 &#39;_resource&#39;: TriangleMesh with 330263 points and 485077 triangles.,
 &#39;_cartesianTransform&#39;: array([[ 1.        ,  0.        ,  0.        , 27.45802746],
        [ 0.        ,  1.        ,  0.        , 72.81697582],
        [ 0.        ,  0.        ,  1.        ,  4.60116236],
        [ 0.        ,  0.        ,  0.        ,  1.        ]])}
</pre></div>
</div>
</div>
</div>
<section id="sessionnode">
<h4>SessionNode<a class="headerlink" href="#sessionnode" title="Link to this heading"></a></h4>
<p>From the above nodes, a overarching session can be created. As such, 2 sessions are created, one for each meaurement epoch.</p>
<p><strong>Note</strong>: This analysis currently solely relies on a geometric evaluation. As such, there is no need for image processing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linkedNodes</span><span class="o">=</span><span class="n">pcdNodes</span> <span class="o">+</span> <span class="p">[</span><span class="n">meshNode</span><span class="p">]</span>

<span class="n">week22</span><span class="o">=</span><span class="n">SessionNode</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;session_week22&#39;</span><span class="p">,</span> <span class="n">linkedNodes</span><span class="o">=</span><span class="n">linkedNodes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>47
file:///session_week22
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">week22</span><span class="o">.</span><span class="n">save_resource</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.4</strong>: (red) orientedBoundingBoxes of the pcdNodes and the meshNode, (red cones) scaled img field-of-views and (green) convex hull of the sessionNode.
<img alt="rendering" src="../_images/week22_session1.PNG" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pcdboxes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_oriented_bounding_box</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pcdNodes</span> <span class="p">]</span>
<span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">pcdboxes</span><span class="p">:</span>
    <span class="n">box</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">imggeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_mesh_geometry</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">imgNodes</span> <span class="p">]</span>
<span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imggeometries</span><span class="p">]</span>

<span class="n">meshbox</span><span class="o">=</span><span class="n">meshNode</span><span class="o">.</span><span class="n">get_oriented_bounding_box</span><span class="p">()</span>
<span class="n">meshbox</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">lineset1</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_triangle_mesh</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
<span class="n">lineset1</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LineSet with 135 lines.
</pre></div>
</div>
</div>
</div>
<p>Now it is good practice to already serialize these nodes in a RDF graph so we can rapidly load the nodes from the graphs in a next run. The facilitate the datastructure, we will store the generated graph in the same location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;sessionGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">week22</span><span class="o">.</span><span class="n">to_graph</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@prefix e57: &lt;http://libe57.org#&gt; .
@prefix openlabel: &lt;https://www.asam.net/index.php?eID=dumpFile&amp;t=f&amp;f=3876&amp;token=413e8c85031ae64cc35cf42d0768627514868b2f#&gt; .
@prefix v4d: &lt;https://w3id.org/v4d/core#&gt; .

&lt;file:///session_week22&gt; a v4d:SessionNode ;
    e57:cartesianBounds &quot;&quot;&quot;[-52.61117755 125.37352753   2.92507553 165.88417048  -7.61820602
  53.73831177]&quot;&quot;&quot; ;
    e57:cartesianTransform &quot;&quot;&quot;[[ 1.          0.          0.         33.33256501]
 [ 0.          1.          0.         76.57464619]
 [ 0.          0.          1.         22.28746892]
 [ 0.          0.          0.          1.        ]]&quot;&quot;&quot; ;
    v4d:linkedSubjects &quot;[&#39;file:///academiestraat_week_22_39&#39;, &#39;file:///academiestraat_week_22_38&#39;, &#39;file:///academiestraat_week_22_37&#39;, &#39;file:///academiestraat_week_22_36&#39;, &#39;file:///academiestraat_week_22_35&#39;, &#39;file:///academiestraat_week_22_34&#39;, &#39;file:///academiestraat_week_22_33&#39;, &#39;file:///academiestraat_week_22_31&#39;, &#39;file:///academiestraat_week_22_29&#39;, &#39;file:///academiestraat_week_22_28&#39;, &#39;file:///academiestraat_week_22_25&#39;, &#39;file:///academiestraat_week_22_24&#39;, &#39;file:///academiestraat_week_22_23&#39;, &#39;file:///academiestraat_week_22_22&#39;, &#39;file:///academiestraat_week_22_21&#39;, &#39;file:///academiestraat_week_22_20&#39;, &#39;file:///academiestraat_week_22_19&#39;, &#39;file:///academiestraat_week_22_18&#39;, &#39;file:///academiestraat_week_22_17&#39;, &#39;file:///academiestraat_week_22_16&#39;, &#39;file:///academiestraat_week_22_15&#39;, &#39;file:///academiestraat_week_22_14&#39;, &#39;file:///academiestraat_week_22_13&#39;, &#39;file:///academiestraat_week_22_12&#39;, &#39;file:///academiestraat_week_22_11&#39;, &#39;file:///academiestraat_week_22_10&#39;, &#39;file:///academiestraat_week_22_9&#39;, &#39;file:///academiestraat_week_22_8&#39;, &#39;file:///academiestraat_week_22_7&#39;, &#39;file:///academiestraat_week_22_6&#39;, &#39;file:///academiestraat_week_22_5&#39;, &#39;file:///academiestraat_week_22_3&#39;, &#39;file:///academiestraat_week_22_2&#39;, &#39;file:///academiestraat_week_22_1&#39;, &#39;file:///academiestraat_week_22b_13&#39;, &#39;file:///academiestraat_week_22b_12&#39;, &#39;file:///academiestraat_week_22b_11&#39;, &#39;file:///academiestraat_week_22b_10&#39;, &#39;file:///academiestraat_week_22b_9&#39;, &#39;file:///academiestraat_week_22b_8&#39;, &#39;file:///academiestraat_week_22b_7&#39;, &#39;file:///academiestraat_week_22b_6&#39;, &#39;file:///academiestraat_week_22b_5&#39;, &#39;file:///academiestraat_week_22b_3&#39;, &#39;file:///academiestraat_week_22b_2&#39;, &#39;file:///academiestraat_week_22b_1&#39;, &#39;file:///week22&#39;]&quot; ;
    v4d:name &quot;session_week22&quot; ;
    v4d:orientedBounds &quot;&quot;&quot;[[-44.86150601 163.75358449  66.14709087]
 [134.36227138 147.52053539  72.20018649]
 [-58.88269774   3.0278189   50.26458954]
 [-41.65877793 170.94034329  -9.40797122]
 [123.54380773  -6.01847141 -19.23737693]
 [-55.67996966  10.21457769 -25.29047255]
 [137.56499946 154.70729418  -3.3548756 ]
 [120.34107965 -13.20523021  56.31768516]]&quot;&quot;&quot; ;
    v4d:path &quot;session_week22.ply&quot; ;
    openlabel:timestamp &quot;2022-08-31T14:07:41&quot; .
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h4>Reloading from graph<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>Similar to the BIM preprocessing, the above steps only have to be performed once. On reruns of the code or future analysis, we can initialize the same nodes from their serialized triples. This is significantly faster for smaller graphs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessionGraphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;sessionGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">week22</span><span class="o">=</span><span class="n">SessionNode</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">sessionGraphPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#get resourceGraphs</span>
<span class="n">resourceGraph</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;IMG&#39;</span><span class="p">,</span><span class="s1">&#39;imgGraph.ttl&#39;</span><span class="p">))</span>
<span class="n">resourceGraph</span><span class="o">+=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">,</span><span class="s1">&#39;meshGraph.ttl&#39;</span><span class="p">))</span>
<span class="n">resourceGraph</span><span class="o">+=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">,</span><span class="s1">&#39;pcdGraph.ttl&#39;</span><span class="p">))</span>

<span class="n">week22</span><span class="o">.</span><span class="n">get_linked_nodes</span><span class="p">(</span><span class="n">resourceGraph</span><span class="o">=</span><span class="n">resourceGraph</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>43
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>              
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_e57Index&#39;: 2,
 &#39;pointCount&#39;: 11965832,
 &#39;e57XmlPath&#39;: None,
 &#39;_cartesianBounds&#39;: array([-11.26517105,  83.59384155,  23.63994217, 106.9466095 ,
          1.22087526,  51.38877487]),
 &#39;_orientedBounds&#39;: None,
 &#39;_orientedBoundingBox&#39;: None,
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///academiestraat_week_22_37&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=N5f27d492d00a49d4af61547c0720e4fc (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: None,
 &#39;_path&#39;: &#39;C:\\Users\\u0094523\\Documents\\week 22 lidar_CC.e57&#39;,
 &#39;_name&#39;: &#39;academiestraat week 22 37&#39;,
 &#39;_timestamp&#39;: &#39;2022-08-31T14:07:41&#39;,
 &#39;_resource&#39;: None,
 &#39;_cartesianTransform&#39;: array([[ 4.06433852e-01,  9.13346423e-01,  2.46948508e-02,
          2.95436743e+01],
        [-9.13380668e-01,  4.06844203e-01, -1.46133214e-02,
          6.62387305e+01],
        [-2.33939817e-02, -1.66164508e-02,  9.99588223e-01,
          4.85315968e+00],
        [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
          1.00000000e+00]]),
 &#39;type&#39;: &#39;https://w3id.org/v4d/core#PointCloudNode&#39;}
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="theoretical-visibility-week-22">
<h3>Theoretical visibility week 22<a class="headerlink" href="#theoretical-visibility-week-22" title="Link to this heading"></a></h3>
<p>To assess the coverage of each BIM object <span class="math notranslate nohighlight">\(n_i \in N\)</span>, one first needs to determine the theoretical visibility per object <span class="math notranslate nohighlight">\(c_i\)</span>. The theoretical visibility <span class="math notranslate nohighlight">\(v_i \in \bold{V}\)</span> per object is defined as the portion of the boundary surface area that does not collide with other BIM geometries. To this end, a point cloud per object <span class="math notranslate nohighlight">\(P_i \in \)</span> is sampled with a resolution of <span class="math notranslate nohighlight">\(0.1m\)</span> after which the proximity of these points to the remaining BIM objects <span class="math notranslate nohighlight">\(N \backslash n_i\)</span> is evaluated.</p>
<div class="math notranslate nohighlight">
\[ P_{i'}=\{ p_i|p_i \in P_i,q_j \in \bold{P}\backslash P_i : \min (p_i -q_j) \leq r \} \]</div>
<div class="math notranslate nohighlight">
\[ v_i = \frac{|P_{i'}|}{|P_i|}\]</div>
<section id="compute-theoretical-visibility-v-i-of-bimnodes">
<h4>Compute theoretical visibility <span class="math notranslate nohighlight">\(v_i\)</span> of BIMNodes<a class="headerlink" href="#compute-theoretical-visibility-v-i-of-bimnodes" title="Link to this heading"></a></h4>
<p>First, we gather the relevant reference and target geometries we wish to sample</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bimGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bimGeometries</span><span class="p">))</span>
<span class="n">ifcBeamNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ifcBeamNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>
<span class="n">ifcBeamGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ifcBeamNodes</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ifcBeamGeometries</span><span class="p">))</span>

<span class="n">ifcColumnNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ifcColumnNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>
<span class="n">ifcColumnGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ifcColumnNodes</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ifcColumnGeometries</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3525
417
217
</pre></div>
</div>
</div>
</div>
<p>Next, we sample the visibile point clouds on the ifcBeam elements. The result is a set of point clouds and the percentage of the surface area that does not collide with other geometries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ifcBeamPointClouds</span><span class="p">,</span> <span class="n">ifcBeamPercentages</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">create_visible_point_cloud_from_meshes</span><span class="p">(</span><span class="n">geometries</span><span class="o">=</span><span class="n">ifcBeamGeometries</span><span class="p">,</span><span class="n">references</span><span class="o">=</span><span class="n">bimGeometries</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ifcBeamPercentages</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.33598800133307477
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ifcBeamNodes</span><span class="p">):</span>
    <span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span><span class="o">=</span><span class="n">ifcBeamPercentages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">n</span><span class="o">.</span><span class="n">visibilityPointCloud</span><span class="o">=</span><span class="n">ifcBeamPointClouds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.5</strong>: Example of filtered invisible points between overlapping mesh geometries (left) on IfcColumns and (right) on two adjacent IfcSlabs.
<img alt="rendering" src="../_images/invisible_points.PNG" /></p>
<p><strong>NOTE</strong>: IfcBeam objects have a relavtively low theoretical visibility (avg. 33.7%). This is unsuprising as structural elements are generally among the most occluded elements, even in an IFC with only structural elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ifcColumnPointClouds</span><span class="p">,</span> <span class="n">ifcColumnPercentages</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">create_visible_point_cloud_from_meshes</span><span class="p">(</span><span class="n">geometries</span><span class="o">=</span><span class="n">ifcColumnGeometries</span><span class="p">,</span><span class="n">references</span><span class="o">=</span><span class="n">bimGeometries</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ifcColumnPercentages</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.47724370256813303
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ifcColumnNodes</span><span class="p">):</span>
    <span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span><span class="o">=</span><span class="n">ifcColumnPercentages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">n</span><span class="o">.</span><span class="n">visibilityPointCloud</span><span class="o">=</span><span class="n">ifcColumnPointClouds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The theoretical visibility for IfcColumns is significantly higher due to the foundations in the BIM (Fig.6).</p>
<p><strong>Fig.6</strong>: Overview of the visible sampled IfcBeam (avg. 33.7% visibility) and IfcColumn (avg. 47.8% visibility) point clouds.<br />
<img alt="rendering" src="../_images/visible_points.PNG" /></p>
</section>
</section>
<section id="discard-irrelevant-or-unobserved-resourcenodes-and-bimnodes">
<h3>Discard irrelevant or unobserved resourceNodes and bimNodes<a class="headerlink" href="#discard-irrelevant-or-unobserved-resourcenodes-and-bimnodes" title="Link to this heading"></a></h3>
<p>Before evaluating the geometries, we can optimize the computational process by filtering the inputs based on <strong>three criteria</strong>.</p>
<p><strong>NOTE</strong>: Most of these spatial filters can be purely performed based on metadata, and are therefore very efficient.</p>
<section id="discard-bimnodes-with-a-low-theoretical-visibility">
<h4>(1) Discard BIMNodes with a low theoretical visibility<a class="headerlink" href="#discard-bimnodes-with-a-low-theoretical-visibility" title="Link to this heading"></a></h4>
<p>Objects with a low theoretical visibility <span class="math notranslate nohighlight">\(v_i\leq 0.1\)</span> should be discarded as these cannot be reliably observed. However, this is tricky since the thereotical visibility of the objects change during the construction process. It is therefore advised that the user querries the BIMNodes to match the project status i.e. querring on architecturally finished models in the strucural phase will heavily affect the theoretical visibility of the structural elements. Or not including ifc files or building storeys that weren’t started yet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">targetBimNodes</span><span class="o">=</span><span class="n">ifcBeamNodes</span>
<span class="n">targetBimNodes</span><span class="o">+=</span><span class="n">ifcColumnNodes</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targetBimNodes</span><span class="p">))</span>

<span class="n">visibleBIMNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">targetBimNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span> <span class="o">&gt;=</span><span class="mf">0.1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">))</span>
<span class="n">invisibleBIMNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">targetBimNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span> <span class="o">&lt;</span><span class="mf">0.1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invisibleBIMNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>634
565
69
</pre></div>
</div>
</div>
</div>
<p><strong>Analysis 1</strong> effectively reduces the BIMNode inputs by <strong>avg. 10%</strong> for both ifcClasses.</p>
<p>However, this theoretical visibility is not unambiguous since <strong>(1)</strong> objects that aren’t built can cause theoretical ooclusions, <strong>(2)</strong> the BIM database might contain some container geometries for elements such as beams and <strong>(3)</strong> some modeling mistakes or duplicates negatively impact the theoretical visibility <strong>(Fig.7)</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visibleBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">]</span>
<span class="n">visible</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">visibleBIMGeometries</span><span class="p">)</span>
<span class="n">visibleLineset</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_triangle_mesh</span><span class="p">(</span><span class="n">visible</span><span class="p">)</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">invisbleBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">invisibleBIMNodes</span><span class="p">]</span>
<span class="n">invisible</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">invisbleBIMGeometries</span><span class="p">)</span>
<span class="n">invisibleLineset</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_triangle_mesh</span><span class="p">(</span><span class="n">invisible</span><span class="p">)</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">referenceGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">BIMNodes</span><span class="p">]</span>
<span class="n">reference</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">referenceGeometries</span><span class="p">)</span>
<span class="n">referenceLineset</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_triangle_mesh</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">visibleLineset</span><span class="p">,</span><span class="n">invisibleLineset</span><span class="p">,</span><span class="n">referenceLineset</span><span class="p">,</span><span class="n">referencePcd</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De aangevraagde overdrachtsbewerking wordt niet ondersteund. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De aangevraagde overdrachtsbewerking wordt niet ondersteund. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De aangevraagde overdrachtsbewerking wordt niet ondersteund. 
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.7</strong>: Overview of the theoretical visibility errors (IfcBeam,IfcColumn): (Green) Nodes with <span class="math notranslate nohighlight">\(v_i&gt;geq t_v\)</span>, (red) Nodes with <span class="math notranslate nohighlight">\(v_i\leq t_v\)</span> and (black) referenceNodes.
<img alt="rendering" src="../_images/PoC5.PNG" /></p>
</section>
<section id="check-which-bim-geometries-fall-within-the-session-node">
<h4>(2) Check which BIM geometries fall within the session node<a class="headerlink" href="#check-which-bim-geometries-fall-within-the-session-node" title="Link to this heading"></a></h4>
<p>Objects that are not contained within the session geometries bounding box or lie at the boundary of the bounding box edge can be left out of the calculations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">))</span>
<span class="n">visibleBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">]</span>
<span class="n">indices</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">get_mesh_inliers</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">,</span><span class="n">week22</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
<span class="n">visibleBIMNodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>565
565
</pre></div>
</div>
</div>
</div>
<p><strong>Analysis 2</strong> reveals that all the target BIMNodes in fact fall within scope of the session. This is mostly due to the photogrammetric mesh that spans the entire project.</p>
</section>
<section id="check-which-resources-actually-see-the-target-bim-objects">
<h4>(3) Check which resources actually see the target BIM objects<a class="headerlink" href="#check-which-resources-actually-see-the-target-bim-objects" title="Link to this heading"></a></h4>
<p>Images, point clouds or meshes that don’t in fact observe an object, or observe it merely at the very edge of their bounding box, can be ignored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">))</span>
<span class="n">testBoxes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_oriented_bounding_box</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">]</span>
<span class="n">boxes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_oriented_bounding_box</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">]</span>
<span class="n">relevantResourceNodes</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">boxes</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">gmu</span><span class="o">.</span><span class="n">get_box_inliers</span><span class="p">(</span><span class="n">sourceBox</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">testBoxes</span><span class="o">=</span><span class="n">testBoxes</span><span class="p">,</span><span class="n">t_d</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">relevantResourceNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">relevantResourceNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>47
47
</pre></div>
</div>
</div>
</div>
<p><strong>Analysis 3</strong> reveals that all resources at least see some of the BIMNodes. As such, no resources can be discarded. This again is unsurprising as the beam and colums are spread throughout the project.</p>
<p><strong>NOTE</strong>: In this case, two of the visibility checks did not reduce any resources or bimNodes. However, when dealing with larger projects or specific zones, immense computational advantages are to be gained while the entire analysis only takes about 3s to evaluate over 500 BIM elements and 736 resources representing over 13Gb of data.</p>
</section>
</section>
<section id="import-geometries-week-22">
<h3>Import geometries week 22<a class="headerlink" href="#import-geometries-week-22" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#resourceGeometries=[n.get_resource() for n in relevantResourceNodes]</span>
</pre></div>
</div>
</div>
</div>
<p>This step is the slowest and most RAM demanding step at the actual data has to be loaded.
If left unattended, the above single-thread process would take around 20min and 25Gb of RAM to load in the 46 points clouds, 1 mesh and some 700 images.</p>
<p><strong>Three key optimizations</strong> are therefore impletemented:</p>
<p><strong>(1) Schedule imports as multiple processes</strong>: By parallel importing and processing the data, we can speed up the import around 6 times given 8 cores. o3d classes cannot be pickled on Windows causing the actual transfer from e57 to o3d to run on a single core. This is overcome by working only with np.arrays which speed up the entire process to 1.56min for 45 point clouds (10M points each) on a normal laptop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">week22</span><span class="o">.</span><span class="n">get_linked_resources_multiprocessing</span><span class="p">(</span><span class="n">percentage</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PointCloud with 6022116 points.,
 PointCloud with 6045451 points.,
 PointCloud with 5982916 points.,
 PointCloud with 6027025 points.,
 PointCloud with 6084855 points.,
 PointCloud with 6001275 points.,
 PointCloud with 6006175 points.,
 PointCloud with 6027025 points.,
 PointCloud with 5982916 points.,
 PointCloud with 6006175 points.,
 PointCloud with 5996376 points.,
 PointCloud with 5996376 points.,
 PointCloud with 5991480 points.,
 PointCloud with 6022116 points.,
 PointCloud with 5991480 points.,
 PointCloud with 5968249 points.,
 PointCloud with 5967027 points.,
 PointCloud with 6035620 points.,
 PointCloud with 6027025 points.,
 PointCloud with 6006175 points.,
 PointCloud with 6022116 points.,
 PointCloud with 5967027 points.,
 PointCloud with 5991480 points.,
 PointCloud with 6066369 points.,
 PointCloud with 5982916 points.,
 PointCloud with 6007401 points.,
 PointCloud with 6027025 points.,
 PointCloud with 6022116 points.,
 PointCloud with 6012304 points.,
 PointCloud with 5987809 points.,
 PointCloud with 6006175 points.,
 PointCloud with 6022116 points.,
 PointCloud with 6007401 points.,
 PointCloud with 5991480 points.,
 PointCloud with 5987809 points.,
 PointCloud with 5991480 points.,
 PointCloud with 6035620 points.,
 PointCloud with 6056521 points.,
 PointCloud with 6017209 points.,
 PointCloud with 5982916 points.,
 PointCloud with 6012304 points.,
 PointCloud with 6007401 points.,
 None]
</pre></div>
</div>
</div>
</div>
<p><strong>(2) Store data out of core</strong>: We can create a backup of the downsampled data on drive and temporarily discard resources we don’t need to free up computational resources</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;resources&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">week22</span><span class="o">.</span><span class="n">save_linked_resources</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Scan-to-BIM repository\geomapi\test\testfiles\myAnalysisFolder\resources\academiestraat week 22 39.pcd
</pre></div>
</div>
</div>
</div>
<p><strong>(3) Downsample and discard the data</strong>: By downsampling and discarding the data, and only storing in memory the downsampled data for our analyis, we can significantly reduce the memory demands for the application.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">week22</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-percentage-of-completion-week-22">
<h3>Compute Percentage-of-Completion week 22<a class="headerlink" href="#compute-percentage-of-completion-week-22" title="Link to this heading"></a></h3>
<p>Once the actual resources and BIMNodes, that are valid for the analysis, have been determined, we can asses the built status of each object.</p>
<p>To this end, we compute the Euclidean distance between the geometries in the session and the BIMNodes.</p>
<p><strong>First</strong>, we sample all resources given a 0.1m resolution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pcds</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span> <span class="k">if</span> <span class="s1">&#39;PointCloud&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">))]</span>
<span class="n">meshes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">week22</span><span class="o">.</span><span class="n">linkedNodes</span> <span class="k">if</span> <span class="s1">&#39;TriangleMesh&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">))]</span>
<span class="n">resolution</span><span class="o">=</span><span class="mf">0.1</span>
<span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
    <span class="n">area</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_surface_area</span><span class="p">()</span>
    <span class="n">number_of_points</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">area</span><span class="o">/</span><span class="p">(</span><span class="n">resolution</span><span class="o">*</span><span class="n">resolution</span><span class="p">))</span>
    <span class="n">pcds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">sample_points_uniformly</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pcds</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">referencePcd</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">pcds</span><span class="p">)</span>
<span class="n">referencePcd</span><span class="o">=</span><span class="n">referencePcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">referencePcd</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2611051
</pre></div>
</div>
</div>
</div>
<p><strong>Next</strong>, we determine the percentage of inliers for each BIMGeometry compared to the reference point clouds</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visibleBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">]</span>
<span class="n">percentages</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">determine_percentage_of_coverage</span><span class="p">(</span><span class="n">sources</span><span class="o">=</span><span class="n">visibleBIMGeometries</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="n">referencePcd</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">percentages</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">percentages</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>565
0.14618431693127287
</pre></div>
</div>
</div>
</div>
<p>On average the observed percentage of the objects is 14.6%, which is rather low. <strong>Finally</strong>, the observed percentage per object is compared to its theoretical visibility to asses whether an object is constructed or not given a threshold <span class="math notranslate nohighlight">\(t_v\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PoC</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">):</span>
    <span class="n">PoC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">percentages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span>
    <span class="n">n</span><span class="o">.</span><span class="n">PoC</span><span class="o">=</span><span class="n">PoC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PoC</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.39664788858215816
</pre></div>
</div>
</div>
</div>
<p>Which reveals that the Percentage-of-Completion, i.e. the ratio of the observed surface area over the theoretically visibility is on average 39.6%.</p>
<div class="math notranslate nohighlight">
\[ c_i = \frac{|P_{i'}|}{|P_i|}\]</div>
<div class="math notranslate nohighlight">
\[ constructed = \frac{|P_{i'}|}{|P_i|} \geq t_v\]</div>
<p>with <span class="math notranslate nohighlight">\(t_v\)</span> set to 50% so if atleast half an objects’ visible surface is seen, it is considered built.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">constructedBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">PoC</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">constructedBIMGeometries</span><span class="p">))</span>
<span class="n">unconstructedBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">PoC</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unconstructedBIMGeometries</span><span class="p">))</span>
<span class="n">invisibleBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span><span class="o">&lt;=</span><span class="mf">0.1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invisibleBIMGeometries</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>126
439
0
</pre></div>
</div>
</div>
</div>
<p>|invisibleBIMGeometries| is obviously 0 as these were filtered out before the analysis started.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">constructed</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">constructedBIMGeometries</span><span class="p">)</span>
<span class="n">unconstructed</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">unconstructedBIMGeometries</span><span class="p">)</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">constructed</span><span class="p">,</span><span class="n">unconstructed</span><span class="p">,</span><span class="n">referencePcd</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.8</strong>: Overview of the construction state of the BIM Elements(ifcBeam,ifcColumn) (avg.39.6% PoC): (Green) Constructed elements with <span class="math notranslate nohighlight">\(PoC\geq t_v\)</span> (grey) Unconstructed/unseen elements with <span class="math notranslate nohighlight">\(PoC\leq t_v\)</span>
<img alt="rendering" src="../_images/PoC3.PNG" /></p>
<p>However, similar to the theoretical visibility, there are some shortcommings to this method. (1) Nearby constructed objects will increase point inliers on the object, (2) noise, ghosting and clutter will increase point inliers, (3) the point inliers do not necesserily indicate the proper built state since formwork will also show significant point inliers and (4) occlusions cause significant false negatives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lineset1</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_triangle_mesh</span><span class="p">(</span><span class="n">constructed</span><span class="p">)</span>
<span class="n">lineset1</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">lineset1</span><span class="p">,</span><span class="n">unconstructed</span><span class="p">,</span><span class="n">referencePcd</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De aangevraagde overdrachtsbewerking wordt niet ondersteund. 
[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De aangevraagde overdrachtsbewerking wordt niet ondersteund. 
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.9</strong>: Overview of the Poc (inlier method) shortcommings: Example outliers due to noise, nearby constructed elements and auxiliry structures.
<img alt="rendering" src="../_images/PoC4.PNG" /></p>
</section>
<section id="serialize-results-week-22">
<h3>Serialize results week 22<a class="headerlink" href="#serialize-results-week-22" title="Link to this heading"></a></h3>
<p>Dispite some shortcommings, the majority of 126 of the 565 were correctly identified as being built. To build a reliable progress monitoring tool, one should be able to store the PoC results of week 22 and reuse the observations in the week 34 analysis.</p>
<p>To this end, we serialize the results in an <strong>analysis graph</strong>. Concretely, the PoC, theoretical visibility and used parameters are used per object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysisNodes</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">:</span>
    <span class="n">analysisNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BIMNode</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
                            <span class="n">percentageOfCompletion</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">PoC</span><span class="p">,</span>
                            <span class="n">theoreticalVisibility</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">theoreticalVisibility</span><span class="p">,</span>
                            <span class="n">isDerivedFromGeometry</span><span class="o">=</span><span class="n">week22</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
                            <span class="n">offsetDistanceCalculation</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                            <span class="n">analysisTimestamp</span><span class="o">=</span><span class="n">week22</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">analysisNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_graph</span><span class="p">()</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@prefix omg: &lt;https://w3id.org/omg#&gt; .
@prefix v4d: &lt;https://w3id.org/v4d/core#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

&lt;file:///282_SF_f2_Foundation-Rectangular_40_130_998270_3tZF_AuZDAYQfVfU1ic86_&gt; a v4d:BIMNode ;
    omg:isDerivedFromGeometry &quot;file:///session_week22&quot; ;
    v4d:analysisTimestamp &quot;2022-08-31T14:07:41&quot; ;
    v4d:offsetDistanceCalculation &quot;0.1&quot;^^xsd:float ;
    v4d:percentageOfCompletion &quot;0.0&quot;^^xsd:float ;
    v4d:theoreticalVisibility &quot;0.2384180790960452&quot;^^xsd:float .
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysisGraphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;week22analysisGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">tl</span><span class="o">.</span><span class="n">nodes_to_graph</span><span class="p">(</span><span class="n">analysisNodes</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">analysisGraphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Graph identifier=N3cb94120e2f94d23b14216fd5bd4d6b3 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-week-34">
<h2>Analysis week 34<a class="headerlink" href="#analysis-week-34" title="Link to this heading"></a></h2>
<p>The progress estimation in week 34 slightly differs from week 22. In week 34, we do not only have a new set of measurements that we can process. We also have the analysis of week 22 on which we can built. For instance, the theoretical visibility of the BIMNodes is the same, since both measurement epochs are part of the same structure Phase.</p>
<section id="preprocess-measurements-week-34">
<h3>Preprocess measurements week 34<a class="headerlink" href="#preprocess-measurements-week-34" title="Link to this heading"></a></h3>
<p>First, we preprocess the measurements of week 34 as a sessionNode much like week 22.</p>
<ol class="arabic simple">
<li><p><strong>E57 POINT CLOUDS</strong>: These nodes from the e57 header instead of actually importing the data so a first spatial analysis can be conducted effeciently</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e57Path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">u0094523</span><span class="se">\\</span><span class="s2">Documents</span><span class="se">\\</span><span class="s2">week 34</span><span class="se">\\</span><span class="s2">week34_lidar_georef.e57&quot;</span><span class="p">)</span>

<span class="n">pcdNodes</span><span class="o">=</span><span class="n">tl</span><span class="o">.</span><span class="n">e57header_to_nodes</span><span class="p">(</span><span class="n">e57Path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pcdNodes</span><span class="p">))</span>

<span class="c1">#serialize nodes</span>
<span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">,</span><span class="s1">&#39;pcdGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">tl</span><span class="o">.</span><span class="n">nodes_to_graph</span><span class="p">(</span><span class="n">nodelist</span><span class="o">=</span><span class="n">pcdNodes</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">pcdNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>              
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_e57Index&#39;: 0,
 &#39;pointCount&#39;: 6414743,
 &#39;e57XmlPath&#39;: None,
 &#39;_cartesianBounds&#39;: None,
 &#39;_orientedBounds&#39;: None,
 &#39;_orientedBoundingBox&#39;: None,
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///academiestraat_22_week_34_1&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=N21c459e5807745f8a4c94d62c96a9842 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder34\\PCD\\pcdGraph.ttl&#39;,
 &#39;_path&#39;: &#39;C:\\Users\\u0094523\\Documents\\week 34\\week34_lidar_georef.e57&#39;,
 &#39;_name&#39;: &#39;academiestraat 22 week 34 1&#39;,
 &#39;_timestamp&#39;: &#39;2022-09-08T09:01:15&#39;,
 &#39;_resource&#39;: None,
 &#39;_cartesianTransform&#39;: array([[-1.23740218e-01,  9.92220428e-01,  1.36740747e-02,
          3.19596119e+01],
        [-9.92016441e-01, -1.24029090e-01,  2.28071432e-02,
          9.12885202e+01],
        [ 2.43256965e-02, -1.07427460e-02,  9.99646364e-01,
          4.76666118e+00],
        [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
          1.00000000e+00]])}
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Photogrammetric mesh</strong>: Mesh files have no metadata headers so the data has to be loaded by GEOMAPI. However, to save memory (and to illustrate the non-data functionality), we will discard the data as soon as the relevant metadata is extracted.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meshPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">u0094523</span><span class="se">\\</span><span class="s2">Documents</span><span class="se">\\</span><span class="s2">week 34</span><span class="se">\\</span><span class="s2">week34.obj&quot;</span><span class="p">)</span>
<span class="n">meshNode</span><span class="o">=</span><span class="n">MeshNode</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">meshPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#serialize nodes</span>
<span class="n">folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
<span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">,</span><span class="s1">&#39;meshGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">meshNode</span><span class="o">.</span><span class="n">to_graph</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">meshNode</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>     
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;pointCount&#39;: 4190251,
 &#39;faceCount&#39;: 7685546,
 &#39;_cartesianBounds&#39;: array([-21.60602379,  66.36610413,  42.44333649, 124.37586212,
         -2.55043411,  18.72565842]),
 &#39;_orientedBounds&#39;: array([[ 3.09926970e+00,  1.52927627e+02,  2.09918935e+01],
        [ 8.99627806e+01,  1.10374726e+02,  2.21682241e+01],
        [-3.75260534e+01,  6.98601741e+01,  1.59738496e+01],
        [ 3.87313645e+00,  1.53892566e+02, -1.24658549e+00],
        [ 5.01113242e+01,  2.82722128e+01, -5.08829878e+00],
        [-3.67521867e+01,  7.08251137e+01, -6.26462934e+00],
        [ 9.07366473e+01,  1.11339665e+02, -7.02549240e-02],
        [ 4.93374575e+01,  2.73072732e+01,  1.71501802e+01]]),
 &#39;_orientedBoundingBox&#39;: OrientedBoundingBox: center: (26.6053, 90.5999, 7.9518), extent: 96.7337, 92.6056, 22.2729),
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///week34&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=Ne1fea37da8794b198e678d92a6260dd6 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder34\\MESH\\meshGraph.ttl&#39;,
 &#39;_path&#39;: &#39;C:\\Users\\u0094523\\Documents\\week 34\\week34.obj&#39;,
 &#39;_name&#39;: &#39;week34&#39;,
 &#39;_timestamp&#39;: &#39;2022-09-07T09:22:50&#39;,
 &#39;_resource&#39;: TriangleMesh with 4190251 points and 7685546 triangles.,
 &#39;_cartesianTransform&#39;: array([[ 1.        ,  0.        ,  0.        , 13.07415467],
        [ 0.        ,  1.        ,  0.        , 78.13979001],
        [ 0.        ,  0.        ,  1.        ,  5.22154457],
        [ 0.        ,  0.        ,  0.        ,  1.        ]])}
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h4>SessionNode<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>From the above nodes, a overarching session can be created. As such, 2 sessions are created, one for each meaurement epoch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linkedNodes</span><span class="o">=</span><span class="n">pcdNodes</span> <span class="o">+</span> <span class="p">[</span><span class="n">meshNode</span><span class="p">]</span>

<span class="n">week34</span><span class="o">=</span><span class="n">SessionNode</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;session_week34&#39;</span><span class="p">,</span> <span class="n">linkedNodes</span><span class="o">=</span><span class="n">linkedNodes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week34</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">week34</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
file:///session_week34
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">week34</span><span class="o">.</span><span class="n">save_resource</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pcdboxes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">get_oriented_bounding_box</span><span class="p">()</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pcdNodes</span> <span class="p">]</span>
<span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">pcdboxes</span><span class="p">:</span>
    <span class="n">box</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">meshbox</span><span class="o">=</span><span class="n">meshNode</span><span class="o">.</span><span class="n">get_oriented_bounding_box</span><span class="p">()</span>
<span class="n">meshbox</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">lineset</span><span class="o">=</span><span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">LineSet</span><span class="o">.</span><span class="n">create_from_triangle_mesh</span><span class="p">(</span><span class="n">week34</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
<span class="n">lineset</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">(</span><span class="n">pcdboxes</span><span class="o">+</span><span class="p">[</span><span class="n">meshbox</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">lineset</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">meshNode</span><span class="o">.</span><span class="n">resource</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.10</strong>: (red) orientedBoundingBoxes of the pcdNodes and the meshNode and (green) convex hull of the week 34 sessionNode.
<img alt="rendering" src="../_images/week34_session1a.PNG" /></p>
<p><strong>NOTE</strong>: This specific AUTODESK RECAP does not contain cartesianBounds information. As such, placeholder boundingbboxes are generated untill the actual data is loaded. In this case, the convex hull of the session is equal to the orientedBounding box of the mesh.</p>
<p>We can also store this convex hull as the sessionNode’s resource.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">week34</span><span class="o">.</span><span class="n">save_resource</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Now it is good practice to already serialize these nodes in a RDF graph so we can rapidly load the nodes from the graphs in a next run. The facilitate the datastructure, we will store the generated graph in the same location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;sessionGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">week34</span><span class="o">.</span><span class="n">to_graph</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">graphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">week34</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@prefix e57: &lt;http://libe57.org#&gt; .
@prefix openlabel: &lt;https://www.asam.net/index.php?eID=dumpFile&amp;t=f&amp;f=3876&amp;token=413e8c85031ae64cc35cf42d0768627514868b2f#&gt; .
@prefix v4d: &lt;https://w3id.org/v4d/core#&gt; .

&lt;file:///session_week34&gt; a v4d:SessionNode ;
    e57:cartesianBounds &quot;&quot;&quot;[-37.52605343  90.73664735  27.30727318 153.89256624  -6.26462934
  22.16822407]&quot;&quot;&quot; ;
    e57:cartesianTransform &quot;&quot;&quot;[[ 1.          0.          0.          5.71003444]
 [ 0.          1.          0.         84.3190585 ]
 [ 0.          0.          1.          5.43533838]
 [ 0.          0.          0.          1.        ]]&quot;&quot;&quot; ;
    v4d:linkedSubjects &quot;[&#39;file:///academiestraat_22_week_34_1&#39;, &#39;file:///academiestraat_22_week_34_2&#39;, &#39;file:///academiestraat_22_week_34_4&#39;, &#39;file:///academiestraat_22_week_34_5&#39;, &#39;file:///academiestraat_22_week_34_6&#39;, &#39;file:///academiestraat_22_week_34_7&#39;, &#39;file:///academiestraat_22_week_34_8&#39;, &#39;file:///academiestraat_22_week_34_9&#39;, &#39;file:///academiestraat_22_week_34_10&#39;, &#39;file:///academiestraat_22_week_34_11&#39;, &#39;file:///academiestraat_22_week_34_12&#39;, &#39;file:///academiestraat_22_week_34_13&#39;, &#39;file:///academiestraat_22_week_34_16&#39;, &#39;file:///academiestraat_22_week_34_19&#39;, &#39;file:///academiestraat_22_week_34_20&#39;, &#39;file:///academiestraat_22_week_34_21&#39;, &#39;file:///academiestraat_22_week_34_22&#39;, &#39;file:///academiestraat_22_week_34_23&#39;, &#39;file:///academiestraat_22_week_34_24&#39;, &#39;file:///week34&#39;]&quot; ;
    v4d:name &quot;session_week34&quot; ;
    v4d:orientedBounds &quot;&quot;&quot;[[ 3.09926970e+00  1.52927627e+02  2.09918935e+01]
 [ 8.99627806e+01  1.10374726e+02  2.21682241e+01]
 [-3.75260534e+01  6.98601741e+01  1.59738496e+01]
 [ 3.87313645e+00  1.53892566e+02 -1.24658549e+00]
 [ 5.01113242e+01  2.82722128e+01 -5.08829878e+00]
 [-3.67521867e+01  7.08251137e+01 -6.26462934e+00]
 [ 9.07366473e+01  1.11339665e+02 -7.02549240e-02]
 [ 4.93374575e+01  2.73072732e+01  1.71501802e+01]]&quot;&quot;&quot; ;
    v4d:path &quot;session_week34.ply&quot; ;
    openlabel:timestamp &quot;2022-09-08T09:01:15&quot; .
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id3">
<h3>Reloading from graph<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>Similar to the BIM preprocessing, the above steps only have to be performed once. On reruns of the code or future analysis, we can initialize the same nodes from their serialized triples. This is significantly faster for smaller graphs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sessionGraphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;sessionGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">week34</span><span class="o">=</span><span class="n">SessionNode</span><span class="p">(</span><span class="n">graphPath</span><span class="o">=</span><span class="n">sessionGraphPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#get resourceGraphs</span>
<span class="n">resourceGraph</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;MESH&#39;</span><span class="p">,</span><span class="s1">&#39;meshGraph.ttl&#39;</span><span class="p">))</span>
<span class="n">resourceGraph</span><span class="o">+=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;PCD&#39;</span><span class="p">,</span><span class="s1">&#39;pcdGraph.ttl&#39;</span><span class="p">))</span>

<span class="n">week34</span><span class="o">.</span><span class="n">get_linked_nodes</span><span class="p">(</span><span class="n">resourceGraph</span><span class="o">=</span><span class="n">resourceGraph</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">week34</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">week34</span><span class="o">.</span><span class="n">linkedNodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>              
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_e57Index&#39;: 2,
 &#39;pointCount&#39;: 11965832,
 &#39;e57XmlPath&#39;: None,
 &#39;_cartesianBounds&#39;: array([-11.26517105,  83.59384155,  23.63994217, 106.9466095 ,
          1.22087526,  51.38877487]),
 &#39;_orientedBounds&#39;: None,
 &#39;_orientedBoundingBox&#39;: None,
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///academiestraat_week_22_37&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=N996a20535b4b4a5a9cf2fdfacd926e74 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: None,
 &#39;_path&#39;: &#39;C:\\Users\\u0094523\\Documents\\week 22 lidar_CC.e57&#39;,
 &#39;_name&#39;: &#39;academiestraat week 22 37&#39;,
 &#39;_timestamp&#39;: &#39;2022-08-31T14:07:41&#39;,
 &#39;_resource&#39;: None,
 &#39;_cartesianTransform&#39;: array([[ 4.06433852e-01,  9.13346423e-01,  2.46948508e-02,
          2.95436743e+01],
        [-9.13380668e-01,  4.06844203e-01, -1.46133214e-02,
          6.62387305e+01],
        [-2.33939817e-02, -1.66164508e-02,  9.99588223e-01,
          4.85315968e+00],
        [ 0.00000000e+00,  0.00000000e+00,  0.00000000e+00,
          1.00000000e+00]]),
 &#39;type&#39;: &#39;https://w3id.org/v4d/core#PointCloudNode&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="theoretical-visibility-week-34">
<h3>Theoretical visibility week 34<a class="headerlink" href="#theoretical-visibility-week-34" title="Link to this heading"></a></h3>
<p>We assume the theoretical visibility to be unchanged from week 22. As such, we can just reuse the bimGraph and combine it with the analysisGraph from week 22.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bimGraphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;BIM&#39;</span><span class="p">,</span><span class="s1">&#39;bimGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">bimGraph</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">bimGraphPath</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bimGraph</span><span class="p">))</span>
<span class="n">analysisGraph</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;week22analysisGraph.ttl&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analysisGraph</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>42336
3390
</pre></div>
</div>
</div>
</div>
<p>To reduce the number of parsed elements (up from 3528), we retain only the subjects with ifcBeam and ifcColumn classnames which are contained within the intersection of both graphs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intersectionGraph</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">get_graph_intersection</span><span class="p">([</span><span class="n">bimGraph</span><span class="p">,</span><span class="n">analysisGraph</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intersectionGraph</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9605
</pre></div>
</div>
</div>
</div>
<p>In addition to the intersectionGraph, the bimGraphPath should also be provided to complete the resource paths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visibleBIMNodes</span><span class="o">=</span><span class="n">tl</span><span class="o">.</span><span class="n">graph_to_nodes</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">intersectionGraph</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">bimGraphPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">))</span>
<span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>                  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>565
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;_ifcPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder\\IFC\\Academiestraat_parking.ifc&#39;,
 &#39;_globalId&#39;: &#39;3ImCzVI6P6UeXNJl2tafTA&#39;,
 &#39;_cartesianBounds&#39;: array([32.83716386, 33.07297889, 93.90500251, 95.40825674,  6.99      ,
         7.49      ]),
 &#39;_orientedBounds&#39;: array([[33.07297889, 95.40347025,  6.99      ],
        [33.03710657, 93.90500251,  6.99      ],
        [33.07297889, 95.40347025,  7.49      ],
        [32.87303617, 95.40825674,  6.99      ],
        [32.83716386, 93.90978901,  7.49      ],
        [32.87303617, 95.40825674,  7.49      ],
        [32.83716386, 93.90978901,  6.99      ],
        [33.03710657, 93.90500251,  7.49      ]]),
 &#39;_orientedBoundingBox&#39;: OrientedBoundingBox: center: (32.9551, 94.6566, 7.24), extent: 1.4989, 0.5, 0.2),
 &#39;_subject&#39;: rdflib.term.URIRef(&#39;file:///282_SF_f2_Rectangular_20_50_1032696_3ImCzVI6P6UeXNJl2tafTA&#39;),
 &#39;_graph&#39;: &lt;Graph identifier=Nae34111d44684290ac74c87646ff75c3 (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;,
 &#39;_graphPath&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder\\BIM\\bimGraph.ttl&#39;,
 &#39;_path&#39;: &#39;d:\\Scan-to-BIM repository\\geomapi\\test\\testfiles\\myAnalysisFolder\\BIM\\282_SF_f2_Rectangular_20_50_1032696_3ImCzVI6P6UeXNJl2tafTA.ply&#39;,
 &#39;_name&#39;: &#39;282_SF_f2_Rectangular:20/50:1032696&#39;,
 &#39;_timestamp&#39;: &#39;2022-08-24T09:33:45&#39;,
 &#39;_resource&#39;: TriangleMesh with 12 points and 12 triangles.,
 &#39;_cartesianTransform&#39;: array([[ 1.        ,  0.        ,  0.        , 32.94909265],
        [ 0.        ,  1.        ,  0.        , 94.40688501],
        [ 0.        ,  0.        ,  1.        ,  7.24      ],
        [ 0.        ,  0.        ,  0.        ,  1.        ]]),
 &#39;faceCount&#39;: 12,
 &#39;pointCount&#39;: 12,
 &#39;className&#39;: &#39;IfcBeam&#39;,
 &#39;percentageOfCompletion&#39;: 0.0,
 &#39;offsetDistanceCalculation&#39;: 0.1,
 &#39;isDerivedFromGeometry&#39;: &#39;file:///session_week22&#39;,
 &#39;theoreticalVisibility&#39;: 0.28448275862068967,
 &#39;analysisTimestamp&#39;: &#39;2022-08-31T14:07:41&#39;,
 &#39;type&#39;: &#39;https://w3id.org/v4d/core#BIMNode&#39;}
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-geometries-week-34">
<h3>Import geometries week 34<a class="headerlink" href="#import-geometries-week-34" title="Link to this heading"></a></h3>
<p>In the analysis of week 22, no reduction was achieved by the preliminary checks on the remote sensing data. As such, we will forego these checks in week 34 since a similar effect is expected. This is confirmed by Fig.X where the bounding boxes cover the entire construction site.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">week34</span><span class="o">.</span><span class="n">get_linked_resources_multiprocessing</span><span class="p">(</span><span class="n">percentage</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[PointCloud with 3207371 points.,
 PointCloud with 3083122 points.,
 PointCloud with 4399131 points.,
 PointCloud with 2797306 points.,
 PointCloud with 3068398 points.,
 PointCloud with 3373537 points.,
 PointCloud with 3595908 points.,
 PointCloud with 3423975 points.,
 PointCloud with 3476483 points.,
 PointCloud with 3763683 points.,
 PointCloud with 3546451 points.,
 PointCloud with 4573729 points.,
 PointCloud with 4764464 points.,
 PointCloud with 3503286 points.,
 PointCloud with 4602058 points.,
 PointCloud with 2933539 points.,
 PointCloud with 3455878 points.,
 PointCloud with 3913517 points.,
 PointCloud with 3207336 points.,
 TriangleMesh with 4190251 points and 7685546 triangles.]
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-percentage-of-completion-week-34">
<h3>Compute Percentage-of-Completion week 34<a class="headerlink" href="#compute-percentage-of-completion-week-34" title="Link to this heading"></a></h3>
<p>Simimlar to week 22, we first calculate the Percentage-of-Completion solely based on the observations of week 34.</p>
<p>To this end, we compute the Euclidean distance between the geometries in the session and the BIMNodes.</p>
<p><strong>First</strong>, we sample all resources given a 0.1m resolution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pcds</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">week34</span><span class="o">.</span><span class="n">linkedNodes</span> <span class="k">if</span> <span class="s1">&#39;PointCloud&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">))]</span>
<span class="n">meshes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">week34</span><span class="o">.</span><span class="n">linkedNodes</span> <span class="k">if</span> <span class="s1">&#39;TriangleMesh&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">))]</span>
<span class="n">resolution</span><span class="o">=</span><span class="mf">0.1</span>
<span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">meshes</span><span class="p">:</span>
    <span class="n">area</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_surface_area</span><span class="p">()</span>
    <span class="n">number_of_points</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">area</span><span class="o">/</span><span class="p">(</span><span class="n">resolution</span><span class="o">*</span><span class="n">resolution</span><span class="p">))</span>
    <span class="n">pcds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">sample_points_uniformly</span><span class="p">(</span><span class="n">number_of_points</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pcds</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">referencePcd</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">pcds</span><span class="p">)</span>
<span class="n">referencePcd</span><span class="o">=</span><span class="n">referencePcd</span><span class="o">.</span><span class="n">voxel_down_sample</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">referencePcd</span><span class="o">.</span><span class="n">points</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1497147
</pre></div>
</div>
</div>
</div>
<p><strong>Next</strong>, we determine the percentage of inliers for each BIMGeometry compared to the reference point clouds</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">targetBimGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">]</span>
<span class="n">percentages</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">determine_percentage_of_coverage</span><span class="p">(</span><span class="n">sources</span><span class="o">=</span><span class="n">targetBimGeometries</span><span class="p">,</span><span class="n">reference</span><span class="o">=</span><span class="n">referencePcd</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">percentages</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">percentages</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>565
0.12657436250950596
</pre></div>
</div>
</div>
</div>
<p>On average the observed percentage of the objects is 12.5%, which is in line with week 22 (14.5%). When compared to its theoretical visibility, we get the following result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PoC</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">):</span>
    <span class="n">PoC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">percentages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">theoreticalVisibility</span>
    <span class="n">n</span><span class="o">.</span><span class="n">PoC</span><span class="o">=</span><span class="n">PoC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">PoC</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3778340465226297
</pre></div>
</div>
</div>
</div>
<p>Which reveals that the Percentage-of-Completion (PoC), i.e. the ratio of the observed surface area over the theoretically visibility is on average <strong>37.8%</strong>.</p>
<p><strong>Note</strong>: the PoC can exceed 1.0 in some cases. This is due to</p>
<ol class="arabic simple">
<li><p>The search distance of the inliers, which can report false positives on hidden points that fall within the ditance treshhotl.</p></li>
<li><p>An underestimation of theoretical visibility as it was computed on the full model.</p></li>
</ol>
<p>Overall, the PoC is similar to week 22. This does not impy no progress is to be reported. Instead, the PoC depends on the scope of the session and the work progression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">constructedBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">PoC</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">constructedBIMGeometries</span><span class="p">))</span>
<span class="n">unconstructedBIMGeometries</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">PoC</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unconstructedBIMGeometries</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>107
458
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visible</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">constructedBIMGeometries</span><span class="p">)</span>
<span class="n">invisible</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">unconstructedBIMGeometries</span><span class="p">)</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">([</span><span class="n">visible</span><span class="p">,</span><span class="n">invisible</span><span class="p">,</span><span class="n">referencePcd</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De ingang is ongeldig. 
</pre></div>
</div>
</div>
</div>
</section>
<section id="serialize-results-week-34">
<h3>Serialize results week 34<a class="headerlink" href="#serialize-results-week-34" title="Link to this heading"></a></h3>
<p>However, when serializing these results, it is revealed that only 136 of the 656 objects are constructed in week 34 in contrast to 143 objects in week22. This can have a multitude of reasons including <strong>(1)</strong> occluded elements by work progression, <strong>(2)</strong> remote sensing data taking in different locations and <strong>(3)</strong> noise and errors in the distance evaluation.</p>
<p><strong>First</strong>, we serialize the results in a second <strong>analysis graph</strong> after which we will compare the progress between both weeks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysisNodes</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">:</span>
    <span class="n">analysisNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BIMNode</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
                            <span class="n">percentageOfCompletion</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">PoC</span><span class="p">,</span>
                            <span class="n">theoreticalVisibility</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">theoreticalVisibility</span><span class="p">,</span>
                            <span class="n">isDerivedFromGeometry</span><span class="o">=</span><span class="n">week34</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
                            <span class="n">offsetDistanceCalculation</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
                            <span class="n">analysisTimestamp</span><span class="o">=</span><span class="n">week34</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">analysisNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_graph</span><span class="p">()</span><span class="o">.</span><span class="n">serialize</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>@prefix omg: &lt;https://w3id.org/omg#&gt; .
@prefix v4d: &lt;https://w3id.org/v4d/core#&gt; .
@prefix xsd: &lt;http://www.w3.org/2001/XMLSchema#&gt; .

&lt;file:///282_SC_f2_Rectangular_30_50#C40_50_967685_31ITCLLef6cxVKsJ1O6Z0P&gt; a v4d:BIMNode ;
    omg:isDerivedFromGeometry &quot;file:///session_week34&quot; ;
    v4d:analysisTimestamp &quot;2022-09-08T09:01:15&quot; ;
    v4d:offsetDistanceCalculation &quot;0.1&quot;^^xsd:float ;
    v4d:percentageOfCompletion &quot;2.136394069823051&quot;^^xsd:float ;
    v4d:theoreticalVisibility &quot;0.3203125&quot;^^xsd:float .
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysisGraphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;week34analysisGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">tl</span><span class="o">.</span><span class="n">nodes_to_graph</span><span class="p">(</span><span class="n">analysisNodes</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">analysisGraphPath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Graph identifier=N1538a1baff2c4310a3279dc89c159bcd (&lt;class &#39;rdflib.graph.Graph&#39;&gt;)&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-changes-between-week-22-and-week-34">
<h3>Compare changes between week 22 and week 34<a class="headerlink" href="#compare-changes-between-week-22-and-week-34" title="Link to this heading"></a></h3>
<p>A crucial aspect of GEOMAPI is its ability to store and use analyses results in subsequent analysis. We already benefitted from the semantic web technologies by serializing the theoretical visibility, which lowered the computational cost for any future analysis. Now, we will also look whether the analysis results can be improved.</p>
<p><strong>First</strong>, let’s determine the changes between both data sets. Ideally, all objects from week 22 are also constructed in week 34 and more. To this end, we querry both analysis graphs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analysisGraph22</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;week22analysisGraph.ttl&#39;</span><span class="p">))</span>
<span class="n">analysisGraph34</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder34&#39;</span><span class="p">,</span><span class="s1">&#39;week34analysisGraph.ttl&#39;</span><span class="p">))</span>
<span class="n">bimGraphPath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;test&#39;</span><span class="p">,</span><span class="s1">&#39;testfiles&#39;</span><span class="p">,</span><span class="s1">&#39;myAnalysisFolder&#39;</span><span class="p">,</span><span class="s1">&#39;BIM&#39;</span><span class="p">,</span><span class="s1">&#39;bimGraph.ttl&#39;</span><span class="p">)</span>
<span class="n">bimGraph</span><span class="o">=</span><span class="n">Graph</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">bimGraphPath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v4d</span><span class="o">=</span><span class="n">rdflib</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="s1">&#39;https://w3id.org/v4d/core#&#39;</span><span class="p">)</span>
<span class="n">intersectionGraph</span><span class="o">=</span><span class="n">analysisGraph22</span> <span class="o">&amp;</span> <span class="n">bimGraph</span>
<span class="n">t_v</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">subjectsUnconstructed</span><span class="o">=</span><span class="p">[]</span>
<span class="n">subjectsInWeek22</span><span class="o">=</span><span class="p">[]</span>
<span class="n">subjectsInWeek22and34</span><span class="o">=</span><span class="p">[]</span>
<span class="n">subjectsInWeek34</span><span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">intersectionGraph</span><span class="o">.</span><span class="n">subjects</span><span class="p">(</span><span class="n">RDF</span><span class="o">.</span><span class="n">type</span><span class="p">):</span>
    <span class="n">poc22</span> <span class="o">=</span> <span class="n">analysisGraph22</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span><span class="n">predicate</span><span class="o">=</span><span class="n">v4d</span><span class="p">[</span><span class="s1">&#39;percentageOfCompletion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">toPython</span><span class="p">()</span>
    <span class="n">poc34</span> <span class="o">=</span> <span class="n">analysisGraph34</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subject</span><span class="p">,</span><span class="n">predicate</span><span class="o">=</span><span class="n">v4d</span><span class="p">[</span><span class="s1">&#39;percentageOfCompletion&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">toPython</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">poc22</span> <span class="o">&lt;</span><span class="n">t_v</span> <span class="ow">and</span> <span class="n">poc34</span> <span class="o">&lt;</span> <span class="n">t_v</span><span class="p">:</span>
        <span class="n">subjectsUnconstructed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">poc22</span> <span class="o">&gt;=</span><span class="n">t_v</span> <span class="ow">and</span> <span class="n">poc34</span> <span class="o">&lt;</span> <span class="n">t_v</span><span class="p">:</span>
        <span class="n">subjectsInWeek22</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">poc22</span> <span class="o">&gt;=</span><span class="n">t_v</span> <span class="ow">and</span> <span class="n">poc34</span> <span class="o">&gt;=</span> <span class="n">t_v</span><span class="p">:</span>
        <span class="n">subjectsInWeek22and34</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">poc22</span> <span class="o">&lt;</span><span class="n">t_v</span> <span class="ow">and</span> <span class="n">poc34</span> <span class="o">&gt;=</span> <span class="n">t_v</span><span class="p">:</span>
        <span class="n">subjectsInWeek34</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>
        
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subjectsUnconstructed</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subjectsInWeek22</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subjectsInWeek22and34</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subjectsInWeek34</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>418
40
86
21
</pre></div>
</div>
</div>
</div>
<p>The above code shows the following results.</p>
<ol class="arabic simple">
<li><p>418 BIM Elements were not constructed in both weeks (Fig.X grey elements).</p></li>
<li><p>40 elements were found in week 22 but not in week 34. We will first assume that these elements are simply not recorded but indeed built as they are recorded in week 22.</p></li>
<li><p>86 elements were considered built in both weeks, showing a considerable overlap in documentation. <strong>NOTE</strong>,  this should be lowered if possible to make the analysis more efficient.</p></li>
<li><p>21 new elements were considered built in week 34</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intersectionGraph</span><span class="o">=</span><span class="n">ut</span><span class="o">.</span><span class="n">get_graph_intersection</span><span class="p">([</span><span class="n">bimGraph</span><span class="p">,</span><span class="n">analysisGraph22</span><span class="p">])</span>
<span class="n">visibleBIMNodes</span><span class="o">=</span><span class="n">tl</span><span class="o">.</span><span class="n">graph_to_nodes</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">intersectionGraph</span><span class="p">,</span><span class="n">graphPath</span><span class="o">=</span><span class="n">bimGraphPath</span><span class="p">,</span><span class="n">getResource</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">visibleBIMNodes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>565
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geometries</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">visibleBIMNodes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">subject</span> <span class="ow">in</span> <span class="n">subjectsUnconstructed</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">subject</span> <span class="ow">in</span> <span class="n">subjectsInWeek22</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">subject</span> <span class="ow">in</span> <span class="n">subjectsInWeek22and34</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.706</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">subject</span> <span class="ow">in</span> <span class="n">subjectsInWeek34</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">paint_uniform_color</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">geometries</span><span class="o">=</span><span class="n">gmu</span><span class="o">.</span><span class="n">join_geometries</span><span class="p">(</span><span class="n">geometries</span><span class="p">)</span>
<span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">draw_geometries</span><span class="p">(</span><span class="n">geometries</span> <span class="o">+</span> <span class="p">[</span><span class="n">meshNode</span><span class="o">.</span><span class="n">resource</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Open3D WARNING] GLFW Error: WGL: Failed to make context current: De aangevraagde overdrachtsbewerking wordt niet ondersteund. 
</pre></div>
</div>
</div>
</div>
<p><strong>Fig.11</strong>: Overview of the IfcBeam and IfcColumn progression in week 22 and 34. (grey) unconstructed elements in both week, (red) objects only observed in week 22, (yellow) objects observed in both weeks and (green) objects only observed in week 34.</p>
<a class="reference internal image-reference" href="../_images/week34_poc4a.PNG"><img alt="../_images/week34_poc4a.PNG" src="../_images/week34_poc4a.PNG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week34_poc5a.PNG"><img alt="../_images/week34_poc5a.PNG" src="../_images/week34_poc5a.PNG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week34_poc6a.PNG"><img alt="../_images/week34_poc6a.PNG" src="../_images/week34_poc6a.PNG" style="width: 49%;" />
</a>
<a class="reference internal image-reference" href="../_images/week34_poc7a.PNG"><img alt="../_images/week34_poc7a.PNG" src="../_images/week34_poc7a.PNG" style="width: 49%;" />
</a>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading"></a></h2>
<p>In this testcase, we determined the work progress on beam and column elements in two measurement epochs using GEOMAPI functionality. The following conclusions can be drawn from the above tests.</p>
<p><strong>GEOMAPI</strong>: Over 70 point clouds (&gt;700M points), meshes and 2 IFC structure models are processed in under 6-10 minutes by smartly dealing with the objects metadata and parallel processing whereever possible. This shows a core strength of GEOMAPI that looks to facilitate big data remote sensing processing.</p>
<p><strong>Storing results</strong>: With only a few commands, we stored both the analysis parameters and results in a standardised manner. By using Graphs to store metadata and analysis results, combining data from multiple sources has become very intuitive. This promotes accessibility of the results and also increases their longevity wich is a crucial problem in current analyses.</p>
<p><strong>Construction site documentation</strong>: The progress estimation of both weeks showed that nearly 60% of the observed elements were documented in both weeks, which indicates a significant overlap in both measurement epochs. Since the documentation is the most costly step, and also computationally burdens downstream analyses, this should be lowered. Instead, site documentation should focus on only the parts that actually changed if possible.</p>
<p><strong>Analysis</strong>: The proposed progress method, based on point inliers, gives a coarse approximation of which objects are built. However, some inherent errors are present. For instance, the PoC will overshoot the number of constructed elements due to noise, auxilary objects such as formwork and the search distance. The method will also undershoot for objects that are difficult observe.</p>
</section>
<section id="future-work">
<h2>Future work<a class="headerlink" href="#future-work" title="Link to this heading"></a></h2>
<p>Future work will focus on the development of a more inclusice PoC method, possibly also based on image detection [1]. The decision function will also be replaced with a more State-of-the-art machine learning method that looks are appearance descriptors instead of solely evaluating point inliers based on previous work (Bassier et al., 2019).</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Cuypers, S., Bassier, M., &amp; Vergauwen, M. (2021). Deep Learning on Construction Sites : A Case Study of Sparse Data Learning Techniques for Rebar Segmentation. Sensors, 1–20.</p></li>
<li><p>Bassier, M., Vincke, S., Mattheuwsen, L., De Lima Hernandez, R., Derdaele, J., &amp; Vergauwen, M. (2019). Percentage of completion of in-situ cast concrete walls using point cloud data and bim. International Archives of the Photogrammetry, Remote Sensing and Spatial Information Sciences - ISPRS Archives, 42(5/W2), 21–28. https://doi.org/10.5194/isprs-archives-XLII-5-W2-21-2019</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="combinationtools.html" class="btn btn-neutral float-left" title="Combination Tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="validationtools.html" class="btn btn-neutral float-right" title="Validation Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Bassier M., De Geyter S., De Winter H., Vermandere J. @ Geomatics KU Leuven.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>